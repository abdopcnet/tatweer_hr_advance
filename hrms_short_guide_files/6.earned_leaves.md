# Earned Leaves Setup

## Overview

Earned Leaves are automatically allocated monthly based on annual allocation.

## Prerequisites

### Leave Type Setup

-   `is_earned_leave` (Check): Must be checked
-   `earned_leave_frequency` (Select): Set to "Monthly"
-   `allocate_on_day` (Select): Set to "First Day" or specific day

### Leave Policy Setup

-   Create Leave Policy with leave type
-   Set `annual_allocation` in Leave Policy Detail (e.g., 30 days)

### Leave Policy Assignment

-   Assign Leave Policy to employee
-   Leave Allocation is created automatically with `leave_policy_assignment` link

## Automatic Allocation

### Scheduler

-   Function: `hrms.hr.utils.allocate_earned_leaves`
-   Runs: Daily (daily_long scheduler event)
-   Checks: If today matches `allocate_on_day`

### Calculation

```
earned_leaves = annual_allocation / 12
```

Example:

-   `annual_allocation` = 30 days
-   `earned_leaves` = 30 / 12 = 2.5 days per month

### Process

1. Scheduler checks if today matches `allocate_on_day`
2. Fetches `annual_allocation` from Leave Policy Detail
3. Calculates `earned_leaves`
4. Updates `total_leaves_allocated` in Leave Allocation
5. Creates Leave Ledger Entry
6. Adds comment to Leave Allocation

## Fields Reference

### Leave Type

-   `is_earned_leave` (Check): Enable earned leaves
-   `earned_leave_frequency` (Select): Monthly/Quarterly/Half-Yearly/Yearly
-   `allocate_on_day` (Select): First Day/Last Day/Specific day

### Leave Policy Detail

-   `annual_allocation` (Float): Total annual leave days

### Leave Allocation

-   `leave_policy_assignment` (Link): Required for automatic allocation
-   `total_leaves_allocated` (Float): Updated monthly by scheduler

## Important Notes

-   Leave Allocation must have `leave_policy_assignment` link
-   Scheduler runs daily but allocates only on `allocate_on_day`
-   `new_leaves_allocated` is read-only for earned leaves
-   Manual allocation is not allowed for earned leaves
